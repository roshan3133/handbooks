# iptables

## Kernel configuration

on Kernel 2.6

```
Networking  ---->
   Networking options  ---->
      Network packet filtering framework (Netfilter)--->
         Core Netfilter Configuration ---->
            [*] Netfilter connection tracking support
            [*] Netfilter Xtables support (required for ip_tables)
            [*]   "NFLOG" target support
            [*]   "conntrack" connection tracking match support
            [*]   "state" match support
         IP: Netfilter Configuration --->
            [*] IPv4 connection tracking support (required for NAT)
            [*] IP tables support (required for filtering/masq/NAT)
            [*]   Packet Filtering
            [*]     REJECT target support
            [*]   Full NAT
            [*]     MASQUERADE target support
```

## Install

```
# sudo emerge iptables
```

## First-Setup

```
$ sudo vim /etc/iptables.bak
# Generated by iptables-save v1.4.13 on Fri Nov 30 01:42:18 2012
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]

# accept all from localhost
-A INPUT -i lo -j ACCEPT

# drop invalid packets
-A INPUT -m state --state INVALID -j DROP

# accept all previously established connections
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

# permit ssh into this computer
-A INPUT -p tcp -m state --state NEW -m tcp --dport 2222 -j ACCEPT

# permit web hosting services
-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT

# reject all other packets coming into the computer, even from other computers in the local area network
-A INPUT -j REJECT --reject-with icmp-port-unreachable

COMMIT
# Completed on Fri Nov 30 01:42:18 2012
```

```
$ sudo iptables-restore /etc/iptables.bak
$ sudo /etc/init.d/iptables save  #=> /var/lib/iptables/rules-save

$ sudo /etc/init.d/iptables start
$ sudo rc-update add iptables default
```

## Ref.

* [Iptables for newbies](http://en.gentoo-wiki.com/wiki/Iptables_for_newbies)
* [Iptables](http://en.gentoo-wiki.com/wiki/Iptables)
